@import com.gu.googleauth.UserIdentity
@import com.gu.janus.model.JanusData
@import logic.UserAccess.username
@import play.api.Mode
@import play.filters.csrf.CSRF
@import java.time.Instant

@(user: UserIdentity, janusData: JanusData, passkeys: Seq[models.Passkey], dateFormat: Instant => String)(implicit request: RequestHeader, mode: Mode, assetsFinder: AssetsFinder)

@main("User account", Some(user), janusData) {

    <div class="container">
        <h1 class="header orange-text">Account</h1>

        <div class="row">
            <div class="col s12 m12 l3">
                <div class="card-panel">
                        <p>You are logged in as @username(user).</p><div><a href="/logout"><button class="btn">Log out</button></a></div>
                </div>
            </div>
        </div>

        <h3 class="header orange-text">Passkeys</h3>

        <div class="row">
            <div class="col s12 m12 l9">
                <div class="card-panel">
                    <p>You can have up to two passkeys to log in to Janus. One should be on-device (e.g. Touch ID) and the other off-device (e.g. security key or authenticator app).
                    </p>
                    <div><button id="register-passkey" class="btn" csrf-token="@{CSRF.getToken.get.value}">Register a new passkey</button></div>
                </div>
            </div>
        </div>

        <div class="row">
            @if(passkeys.nonEmpty) {
                @for(passkey <- passkeys) {
                    <div class="col s12 m12 l6">
                        <div class="card-panel">
                            <p>Passkey: @{passkey.name}</p>
                            <p>Added: @{dateFormat(passkey.registrationTime)}</p>
                            <div><button id="delete-passkey" class="btn" csrf-token="@{CSRF.getToken.get.value}" data-passkey="@{passkey.id}">Delete</button></div>
                        </div>
                    </div>
                }
            } else {
                <div class="col s12">
                    <div class="card-panel">
                        <p>You haven't registered any passkeys yet.</p>
                    </div>
                </div>
            }
        </div>

        <div class="row">
            @if(passkeys.nonEmpty) {
                @for(passkey <- passkeys) {
                    <div class="col s12 m12 l6">
                        <div class="card-panel">
                            <p>Passkey: @{passkey}</p>
                            <div><button id="delete-passkey" class="btn" csrf-token="@{CSRF.getToken.get.value}" data-passkey="@passkey">Delete</button></div>
                        </div>
                    </div>
                }
            } else {
                <div class="col s12">
                    <div class="card-panel">
                        <p>You haven't registered any passkeys yet.</p>
                    </div>
                </div>
            }
        </div>
    </div>
}
